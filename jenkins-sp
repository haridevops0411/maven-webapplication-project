node {
    // Fetch the Maven installation path configured in Jenkins
    def mavenHome = tool name: "maven-3.9.11"

    // Stage 1: Git Checkout
    stage('git checkout') {
        git branch: 'dev', url: 'https://github.com/haridevops0411/maven-webapplication-project.git'
            
    }      
    

    // Stage 2: Build the application
    stage('Build') {
        sh "${mavenHome}/bin/mvn clean package"
    }

    // Stage 3: SonarQube Code Quality Report
    stage('SQ Report') {
        sh "${mavenHome}/bin/mvn sonar:sonar"
    }

    // Stage 4: Upload to Nexus Repository
    stage('Deploy into Nexus') {
        sh "${mavenHome}/bin/mvn clean deploy"
    }

    // Stage 5: Deploy WAR to Tomcat using curl
    stage('Deploy to Tomcat') {
        echo "Deploying WAR file using curl..."

        sh """
            curl -u kkfunda:kkfunda \
            --upload-file /var/lib/jenkins/workspace/jio-sp/target/maven-web-application.war \
           "http://3.110.49.64:8080/manager/text/deploy?path=/maven-web-application&update=true"
        """
    }
} // node closing
